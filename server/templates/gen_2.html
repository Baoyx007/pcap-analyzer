{% extends "base.html" %}
{% block content %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>配置2分析</title>
</head>
<body >
    <meta charset="UTF-8">
    <div class="ui two column fitted stackable grid">
        <div class="ui eleven wide column">
            <div class="ui segment">
                <a class="ui orange ribbon label"  style="bottom:10px;">Packets Details</a>
                <div class="ui segments" id="segment_one">
                    <div class="ui segment">
                        <p>request header</p>
                        <p id="request_h">
                            {% for req in frame[0]['req_h'].split('\n')%}
                            {{req}}
                            <br>
                            {% endfor %}
                        </p>
                    </div>
                    <div class="ui segment">
                        <p>Request Body</p>
                        <p style="word-break:break-word;" id="request_b">{{frame[0]['req_b'].decode('utf8')}}</p>
                    </div>
                    <div class="ui segment">
                        <p>Response Header</p>
                        <p id="response_h">
                        {% for req in frame[0]['res_h'].split('\n')%}
                            {{req}}
                            <br>
                        {% endfor %}
                        </p>
                    </div>
                    <div class="ui segment">
                        <p>Response Body</p>
                        <p style="word-break:break-word;" id="response_b">{{frame[0]['res_b'].decode('utf8')}}</p>
                    </div>
                </div>
                <br>
                <div class="ui buttons">
                  <button class="ui labeled icon button blue" id="back"><i class="left chevron icon"></i> Back </button>
                  <button class="ui right labeled icon button blue" id="forward">Forward <i class="right chevron icon"></i> </button>
                </div>
            </div>
        </div>
        <div class="ui five wide column">
            <div class="ui segment">
                 <a class="ui orange ribbon label"  style="bottom:10px;">Packets Details</a>
                 <div class="ui attached segment">
                     <p>这个分段在顶部</p>
                 </div>
                <div class="ui attached segment">
                    <p>此段落附加在两边</p>
                </div>
                <div class="ui attached segment">
                    <p>这个分段在底部</p>
                </div>
                <table class="ui striped table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Date Joined</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>约翰·莉丽亚</td>
                      <td>2013年9月14日</td>
                    </tr>
                    <tr>
                      <td>杰米·哈灵顿</td>
                      <td>2014年1月11日</td>
                    </tr>
                    <tr>
                      <td>吉尔·刘易斯</td>
                      <td>2014年5月11日</td>
                    </tr>
                    <tr>
                      <td>约翰·莉丽亚</td>
                      <td>2013年9月14日</td>
                    </tr>
                    <tr>
                      <td>约翰·莉丽亚</td>
                      <td>2013年9月14日</td>
                    </tr>
                    <tr>
                      <td>杰米·哈灵顿</td>
                      <td>2014年1月11日</td>
                    </tr>
                    <tr>
                      <td>吉尔·刘易斯</td>
                      <td>2014年5月11日</td>
                    </tr>
                    <tr>
                      <td>约翰·莉丽亚</td>
                      <td>2013年9月14日</td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="ui flowing popup bottom left transition" id="hide">
                    <div class="ui divided selection list">
                        <a class="item">aaaaa </a>
                        <a class="item">bbbbb</a>
                        <a class="item">ccccc</a>
                    </div>
            </div>
</body>
</html>


<script >
$(document).ready(function() {
    var frame = {{frame|safe}};
    var res_b=new Array();
    {% for f in frame%}
        res_b.push("{{f['res_b'].decode('utf8')}}");
    {% endfor %}
    var req_b=new Array();
    {% for f in frame%}
        req_b.push("{{f['req_b'].decode('utf8')}}");
    {% endfor %}
    var size=frame.length;
    var i=0;
    function getSelect()
    {
        if(window.getSelection)
        {
            var t=window.getSelection();
            return t;
        }
        else
        {
            var t=document.selection.createRange().text;
            return t;
        }
    }
    function getSplit(text){
        var array=text.split('\n');
        var str="";
        for(var j=0;j<array.length;j++)
        {
            str+=array[j]+"<br>"
        }
        return str;
    }
    $(document).on("contextmenu","#segment_one div",function(e){
        if(typeof e.preventDefault === "function"){
                e.preventDefault();
                e.stopPropagation();
        }else{
                e.returnValue = false;
                e.cancelBubble = true;
        }
        if(getSelect()!=""){
            $("#hide").removeClass('hidden');
            $("#hide").css({"left":e.clientX-140,"top":e.clientY-70}).fadeIn();
            $("#hide").css({"width":200}).fadeIn();
        }
    });
    $('#segment_one div').on("click",function(e){
        if(!$('#hide').is('.hidden'))
        {
            $("#hide").addClass('hidden');
        }
        });
    $('#back').on("click",function(){
        if(i-1>=0)
        {
            i=i-1;
            $('#request_h').html(getSplit(frame[i]['req_h']));
            $('#request_b').html(req_b[i]);
            $('#response_h').html(getSplit(frame[i]['res_h']));
            $('#response_b').html(res_b[i]);
        }else{
            alert("This is the first!");
        }
    });

    $('#forward').on("click",function(){
        if(i+1<size)
        {
            i=i+1;
            $('#request_h').html(getSplit(frame[i]['req_h']));
            $('#request_b').html(req_b[i]);
            $('#response_h').html(getSplit(frame[i]['res_h']));
            $('#response_b').html(res_b[i]);
        }else{
            alert("This is the last!");
        }
    });
});
</script>
{% endblock %}